/* ============================================================================
   PrepPal UI — GitHubスタイル（ライト/ダーク自動）
   ・GitHub系の落ち着いたグレー×アクセント（緑/青）
   ・prefers-color-scheme を尊重 + 手動トグル(data-theme)にも対応
   ========================================================================== */

/* ---- デザイントークン（Light） ---- */
:root{
  --bg:          #f6f8fa;
  --card:        #ffffff;
  --ink:         #24292f;
  --sub:         #57606a;
  --line:        #d0d7de;
  --muted-bg:    #f2f4f7;

  --link:        #0969da;
  --brand:       #2da44e;   /* GitHub green */
  --brand-weak:  #dafbe1;
  --danger:      #d73a49;   /* GitHub red */
  --slate:       #1f6feb;   /* GitHub blue */

  --ring:        3px solid #79c0ff;
  --radius:      12px;
  --radius-sm:   8px;

  --shadow-sm:   0 1px 0 rgba(27,31,36,.04);
  --shadow-md:   0 1px 0 rgba(27,31,36,.04), 0 8px 24px rgba(140,149,159,.2);

  --font-sans:   system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans JP", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
  --font-mono:   ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
}

/* ---- デザイントークン（Dark） ---- */
@media (prefers-color-scheme: dark) {
  :root{
    --bg:          #0d1117;
    --card:        #0d1117;
    --ink:         #c9d1d9;
    --sub:         #8b949e;
    --line:        #30363d;
    --muted-bg:    #161b22;

    --link:        #58a6ff;
    --brand:       #2ea043;
    --brand-weak:  #163e20;
    --danger:      #f85149;
    --slate:       #1f6feb;

    --ring:        3px solid #1f6feb;
    --shadow-sm:   0 0 0 rgba(0,0,0,0);
    --shadow-md:   0 8px 24px rgba(1,4,9,.4);
  }
}

/* ---- data-theme 手動切替（JSで html[data-theme="dark"] を設定） ---- */
html[data-theme="dark"]{
  --bg:          #0d1117;
  --card:        #0d1117;
  --ink:         #c9d1d9;
  --sub:         #8b949e;
  --line:        #30363d;
  --muted-bg:    #161b22;

  --link:        #58a6ff;
  --brand:       #2ea043;
  --brand-weak:  #163e20;
  --danger:      #f85149;
  --slate:       #1f6feb;

  --ring:        3px solid #1f6feb;
  --shadow-sm:   0 0 0 rgba(0,0,0,0);
  --shadow-md:   0 8px 24px rgba(1,4,9,.4);
}

/* ---- ベース ---- */
*{ box-sizing:border-box }
html,body{ height:100% }
/* 追加: UI選択で変えられる変数（既定値） */
:root{
  --ui-font: var(--font-sans);
  --ui-font-size: 14px;
}

body{
  margin:0; background:var(--bg); color:var(--ink);
  /* ▼ ここだけ置換：font の family/size を変数経由に */
  font: var(--ui-font-size) / 1.6 var(--ui-font);
  -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility;
}

/* 入力系も素直に継承させたい場合は任意で追加（なくてもOK） */
input, textarea, select, button { font: inherit; }

a{ color:var(--link); text-decoration:none }
a:hover{ text-decoration:underline }
img{ max-width:100%; display:block }

/* ---- レイアウト ---- */
.container{ max-width:1080px; margin:0 auto; padding:16px; }
.row{ display:flex; align-items:center; gap:12px; }
.wrap{ flex-wrap:wrap }
.spacer{ flex:1 }
.top{ padding-top:10px }

/* ---- ヘッダー ---- */
.brand{ gap:10px }
.logo{
  width:32px; height:32px; border-radius:8px;
  display:grid; place-items:center; color:white; font-weight:700;
  background:linear-gradient(180deg, #238636, #2da44e);
  box-shadow:var(--shadow-sm);
}
.h1{ font-weight:700; font-size:18px }
.sub{ font-size:12px }

.badge, .chip{
  font-size:12px; padding:2px 8px; border-radius:999px; border:1px solid var(--line);
}
.badge{ background:var(--brand-weak); color:var(--brand); border-color:transparent }
.beta{ }
.chip{ color:var(--sub); background:transparent }

/* ---- タブ（UnderlineNav風） ---- */
.tabs{
  display:flex; gap:16px; border-bottom:1px solid var(--line);
  margin-top:8px; padding:0 4px;
}
.tab{
  padding:10px 2px; color:var(--sub); cursor:pointer; user-select:none;
  border-bottom:2px solid transparent; font-weight:600;
}
.tab[aria-selected="true"]{
  color:var(--ink); border-bottom:2px solid var(--slate);
}

/* ---- カード ---- */
.card{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:var(--radius);
  box-shadow:var(--shadow-sm);
  padding:16px; margin-top:14px;
}
.card.small{ padding:12px }
.card-title{ font-weight:700; }

/* ---- 録音エリア ---- */
.rec-area{
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  min-height:280px; border:1px dashed var(--line); border-radius:var(--radius);
  background:var(--muted-bg);
}
.mic-wrap{ position:relative; width:120px; height:120px; border-radius:50%; display:grid; place-items:center; }
.mic-ring, .mic-ring2{
  position:absolute; inset:0; border-radius:50%;
  border:6px solid rgba(45,164,78,.25);
}
.mic-ring2{ inset:10px; border-color: rgba(45,164,78,.18) }
.mic{ width:44px; height:44px; color:var(--ink) }

/* 録音中は波紋アニメ */
.recording .mic-ring{ animation:ping 1.6s infinite }
.recording .mic-ring2{ animation:ping 1.6s .3s infinite }
@keyframes ping{
  0%{ transform:scale(.92); opacity:.6 }
  70%{ transform:scale(1.10); opacity:.15 }
  100%{ transform:scale(1.16); opacity:0 }
}

/* マイクをボタン化（アクセシビリティ配慮） */
.mic-button{
  background:transparent; border:0; padding:0; cursor:pointer;
  border-radius:14px; transition: transform .06s ease-in-out;
}
.mic-button:hover{ transform: translateY(-1px) }
.mic-button:active{ transform: translateY(0) scale(.99) }
.mic-button:focus-visible{ outline: var(--ring); outline-offset: 2px; }

/* ---- 一覧 ---- */
.list{ display:flex; flex-direction:column; gap:8px }
.item{
  background:var(--card); border:1px solid var(--line); border-radius:var(--radius-sm);
  padding:12px 14px; display:grid; grid-template-columns:1fr auto auto; gap:10px; align-items:center;
  transition: background .15s ease;
}
.item:hover{ background:rgba(99,110,123,.06) }
.item-title{ font-weight:600; color:var(--ink) }
.item-sub{ font-size:12px; color:var(--sub) }
.meta{ font-variant-numeric: tabular-nums; color:var(--sub) }
.pill{
  background:var(--brand-weak); color:var(--brand);
  padding:2px 10px; border-radius:999px; font-size:12px; border:1px solid transparent;
}

/* ---- 詳細パネル ---- */
.detail{ display:none; margin-top:12px }
.detail.active{ display:block }
.detail-title{ margin:.5rem 0; font-weight:700 }

/* ---- フォーム/ボタン ---- */
.input{
  padding:10px 12px; border:1px solid var(--line); border-radius:var(--radius-sm);
  background:var(--card); color:var(--ink); min-width:260px;
}
.input:focus{ outline: var(--ring); }

.btn{
  border:1px solid var(--line); border-radius:var(--radius-sm);
  padding:10px 14px; font-weight:600; cursor:pointer; background:var(--card); color:var(--ink);
  transition: background .12s ease, border-color .12s ease, transform .06s ease;
}
.btn:hover{ background:rgba(99,110,123,.06) }
.btn:active{ transform: translateY(1px) }
.btn:focus-visible{ outline: var(--ring); }

.btn-primary{
  background:linear-gradient(180deg, #2ea043, #2da44e); color:#fff; border-color:#2da44e;
}
.btn-primary:hover{ filter:brightness(1.02) }

.btn-danger{
  background:linear-gradient(180deg, #f85149, #d73a49); color:#fff; border-color:#d73a49;
}
.btn.slate{ background:var(--slate); color:#fff; border-color:transparent }
.btn.dark{ background:#0b5ed7; color:#fff; border-color:transparent }

/* ---- ステータス/余白 ---- */
.muted{ color:var(--sub) }
.mb{ margin-bottom:8px }
.mt{ margin-top:8px }
.btns{ margin-top:12px; gap:8px }

/* ---- コード/プレ ---- */
pre{
  white-space:pre-wrap; font-family:var(--font-mono); font-size:13px; line-height:1.55;
  background:var(--bg); border:1px solid var(--line); border-radius:var(--radius-sm); padding:10px;
}

/* ---- アイコンボタン（テーマ切替用） ---- */
.icon-btn{
  background:transparent; border:1px solid var(--line); padding:6px 8px; border-radius:8px; cursor:pointer;
}
.icon-btn:hover{ background:rgba(99,110,123,.06) }
.icon-btn:focus-visible{ outline: var(--ring); }

/* ---- アニメ軽減（ユーザー設定尊重） ---- */
@media (prefers-reduced-motion: reduce){
  .mic-ring, .mic-ring2{ animation:none !important }
  .btn, .mic-button{ transition:none }
}


/* ===== Tabs & Views（タブ切替用の表示制御） ===== */
/* 日本語：タブに対応するビューの基本表示制御。hidden のときだけ非表示にします */
.view{ display:block; }
.view[hidden]{ display:none; }
.view.active{ display:block; }

/* 選択中アイテムのハイライト */
.item.selected{
  outline: 2px solid var(--slate);
  background: rgba(31, 111, 235, 0.08);
}

/* ===== Graphic Recording をビューポートに収める用 ===== */
/* 図版カードのラッパ（ID/クラスは後述JSで自動付与） */
#gRecoWrap{
  /* 画面内に収める。上下に少し余白（24px） */
  max-height: calc(100vh - 24px);
  overflow: hidden;
}

/* キャンバスの表示サイズ（CSSピクセル）を可変に。保存用の論理解像度は維持 */
#gReco{
  display: block;
  width: 100%;        /* 横はコンテナ幅に合わせる */
  height: auto;       /* 縦は比率維持で自動 */
  aspect-ratio: 4 / 3;/* 念のため（1024x768 相当） */
}


/* ---- Notes エディタ: ツールバー & プレビュー ---- */
.editor-toolbar{
  display:flex; align-items:center; gap:6px;
  border:1px solid var(--line); border-radius:8px; padding:6px; background:var(--card);
  margin:8px 0;
}
.editor-toolbar button{
  border:1px solid var(--line); background:var(--muted-bg); padding:6px 10px; border-radius:8px; cursor:pointer;
  font-weight:600;
}
.editor-toolbar button:hover{ filter:brightness(0.98) }
.editor-toolbar .sep{ width:1px; height:22px; background:var(--line); margin:0 2px }
.editor-toolbar .spacer{ flex:1 }
.btn.small{ padding:6px 10px; font-size:13px }

.note-preview{
  border:1px solid var(--line); border-radius:8px; padding:14px; background:var(--bg);
  max-height:60vh; overflow:auto; line-height:1.7;
}
.note-preview h1,.note-preview h2,.note-preview h3{ margin:.6em 0 .3em; }
.note-preview h1{ font-size:1.6rem } .note-preview h2{ font-size:1.3rem } .note-preview h3{ font-size:1.1rem }
.note-preview code{ font-family:var(--font-mono); background:rgba(127,127,127,.12); padding:.1em .35em; border-radius:6px }
.note-preview pre{ background:rgba(127,127,127,.12); padding:12px; border-radius:8px; overflow:auto }
.note-preview blockquote{ border-left:3px solid var(--line); margin:.6em 0; padding:.2em .8em; color:var(--sub) }
.note-preview ul{ padding-left:1.4em } .note-preview ol{ padding-left:1.6em }
.todo{ list-style:none; padding-left:0 } .todo li{ margin:.25em 0 }
.todo input{ margin-right:.4em }
.tag-pill{ display:inline-block; padding:2px 8px; border:1px solid var(--line); border-radius:999px; margin:0 4px 4px 0; font-size:12px; color:var(--sub) }


/* =========================
   カードUI（録音リスト用）
   ========================= */
.record-card {
  border: 1px solid rgba(255,255,255,0.08);
  background: rgba(255,255,255,0.03);
  border-radius: 14px;
  padding: 12px 14px;
  margin: 10px 0;
  transition: transform .08s ease, box-shadow .12s ease;
}
.record-card:hover {
  transform: translateY(-1px);
  box-shadow: 0 6px 14px rgba(0,0,0,0.25);
}
.record-card .card-title {
  font-weight: 600;
  font-size: 1.02rem;
  margin-bottom: 6px;
}
.record-card .card-meta {
  opacity: 0.7;
  font-size: 0.9rem;
}
.record-card .card-actions {
  margin-top: 8px;
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

/* =========================
   トースト通知
   ========================= */
#toastHost {
  position: fixed;
  right: 16px;
  bottom: 16px;
  z-index: 10000;
  display: flex;
  flex-direction: column;
  gap: 10px;
  pointer-events: none; /* クリックを透過 */
}
.toast {
  min-width: 240px;
  max-width: min(420px, 90vw);
  padding: 12px 14px;
  border-radius: 12px;
  background: #222;
  color: #fff;
  border: 1px solid rgba(255,255,255,0.1);
  box-shadow: 0 6px 16px rgba(0,0,0,0.35);
  pointer-events: auto; /* マウス操作を許可 */
  animation: toast-in .15s ease-out;
}
.toast.success { background: #174d2b; }
.toast.error   { background: #5a1f1f; }
.toast.info    { background: #1f2b5a; }
.toast .toast-title { font-weight: 700; margin-bottom: 4px; }
.toast .toast-body  { opacity: 0.95; }
@keyframes toast-in {
  from { transform: translateY(6px); opacity: 0; }
  to   { transform: translateY(0); opacity: 1; }
}

/* =========================
   全画面ローディング
   ========================= */
#loadingOverlay[hidden] { display: none !important; }
#loadingOverlay {
  position: fixed;
  inset: 0;
  z-index: 10001;
  background: rgba(0,0,0,0.38);
  display: grid;
  place-items: center;
  grid-template-rows: auto auto;
  gap: 12px;
  backdrop-filter: blur(1px);
}
.spinner {
  width: 46px;
  height: 46px;
  border: 4px solid rgba(255,255,255,0.25);
  border-top-color: rgba(255,255,255,0.9);
  border-radius: 50%;
  animation: spin .9s linear infinite;
}
.loading-text {
  color: #fff; 
  font-weight: 600;
  text-shadow: 0 1px 2px rgba(0,0,0,0.4);
}
@keyframes spin {
  to { transform: rotate(360deg); }
}

/* =========================
   同期ハイライトの見た目（先行で置いておく）
   ========================= */
.transcript span.active {
  background: rgba(255,255,0,0.15);
  outline: 2px solid rgba(255,255,0,0.35);
  border-radius: 6px;
}


/* もっと見る：共通の折りたたみUI */
.collapsible {
  position: relative;
  overflow: hidden;
  transition: max-height .2s ease;
}

/* 初期は閉じる（高さはお好みで） */
.collapsed {
  max-height: 220px; /* ここで初期の高さを調整 */
}

/* 下からのグラデーションで「続きがある」ことを示す */
.collapsed::after {
  content: "";
  position: absolute;
  left: 0; right: 0; bottom: 0;
  height: 48px;
  pointer-events: none;
  background: linear-gradient(to bottom, rgba(255,255,255,0), var(--bg));
}

/* ダークでも自然にする（任意） */
html[data-theme="dark"] .collapsed::after,
@media (prefers-color-scheme: dark) {
  .collapsed::after {
    background: linear-gradient(to bottom, transparent, #0d1117);
  }
}

/* ボタンの見た目（任意） */
.more-toggle {
  margin-top: 6px;
  font-size: 13px;
}
